"use strict";((e,t)=>{if("object"==typeof exports&&"object"==typeof module)module.exports=t();else if("function"==typeof define&&define.amd)define([],t);else{var o=t();for(var n in o)("object"==typeof exports?exports:e)[n]=o[n]}})(self,(function(){return(self.webpackChunkjodit=self.webpackChunkjodit||[]).push([[633],{40535(e,t,o){o.r(t),o.d(t,{autocomplete:()=>f});var n=o(20255),s=o(91729),i=o(27537),r=o(11169),l=o(52607),u=o(81165),c=o(41685);class a extends c.u1{constructor(e,t){var o;super(e),this.item=t;const{container:n}=this;if((0,l.isFunction)(t.itemRenderer)){const e=t.itemRenderer(t);(0,l.isString)(e)?n.innerHTML=e:n.appendChild(e)}else n.innerText=null!==(o=t.title)&&void 0!==o?o:t.value}className(){return"AutocompleteItem"}}let p=class extends c.qe{constructor(){super(...arguments),this.elements=[],this.currentSelection=-1}className(){return"Autocomplete"}onChangeSelection(e,t){var o;null!=t&&(null===(o=this.elements[t])||void 0===o||o.setMod("active",!1)),this.elements[this.currentSelection].setMod("active",!0),this.elements[this.currentSelection].container.scrollIntoView(!1)}build(e){this.clear(),e.forEach(((e,t)=>{const o=new a(this.jodit,e);this.j.e.on(o.container,"mousedown touchstart",(e=>{e.preventDefault()})).on(o.container,"click",(()=>{this.currentSelection=t,this.select()})),this.append(o)})),this.currentSelection=0,this.onChangeSelection()}selectNext(){this.currentSelection+1>this.elements.length-1?this.currentSelection=0:this.currentSelection+=1}selectPrevious(){0>this.currentSelection-1?this.currentSelection=this.elements.length-1:this.currentSelection-=1}select(){this.j.e.fire("select.autocomplete",this.elements[this.currentSelection].item)}};(0,n.gn)([(0,r.watch)("currentSelection")],p.prototype,"onChangeSelection",null),p=(0,n.gn)([r.component],p);var h=o(10063),d=o(33594),m=o(94522);i.D.prototype.autocomplete={sources:[],maxItems:50,isMatchedQuery:(e,t)=>0===t.toLowerCase().indexOf(e.toLowerCase()),itemRenderer(e){var t;return null!==(t=e.title)&&void 0!==t?t:e.value},insertValueRenderer:e=>e.value+"&nbsp;"};class f extends s.Sy{constructor(){super(...arguments),this.requires=["enter","license"],this.hasStyle=!d.Jodit.fatMode,this.sources=[]}afterInit(e){this.popup=new u.Popup(e),this.popup.setMod("padding",!1),this.list=new p(e),this.popup.setContent(this.list.container),e.e.on("select.autocomplete",(t=>{let o=t.value;(0,l.isFunction)(t.insertValueRenderer)&&(o=t.insertValueRenderer(t)),u.Dom.isNode(o)||(o=e.createInside.fromHTML(o)),((e,t)=>{var o;const{startContainer:n,startOffset:s}=e;if(m.i.isText(n)){const i=null!==(o=n.nodeValue)&&void 0!==o?o:"",r=i.substr(0,s),l=i.substr(s),u=r.split(" ");u[u.length-1]="";const c=u.join(" ");n.nodeValue=c+l,e.setStart(n,c.length),e.insertNode(t)}})(e.s.range,o),this.j.s.setCursorAfter(o),this.popup.close()})).on("keydown.autocomplete",this.onKeyDown).on("keydown.autocomplete",this.onKeyControlDown,{top:!0}).on("beforeEnter.autocomplete",this.onEnter,{top:!0}).on("autocomplete.autocomplete",this.onAutoComplete).on("registerAutocompleteSource.autocomplete",this.registerAutocompleteSource)}registerAutocompleteSource(e){this.sources.push(e)}static isControlKey(e){return e===h.KEY_DOWN||e===h.KEY_UP||e===h.KEY_ENTER||e===h.KEY_TAB}async onKeyDown(e){var t,o;if(e.key===h.KEY_ESC)return void(this.popup.isOpened&&this.popup.close());const{s:n}=this.j;if(f.isControlKey(e.key)||!n.isInsideArea||!n.isCollapsed)return;const s=(null===(t=this.j.s.sel)||void 0===t?void 0:t.rangeCount)?null===(o=this.j.s.sel)||void 0===o?void 0:o.getRangeAt(0):null,i=s&&(e=>{var t,o,n,s;const{startContainer:i,startOffset:r}=e;if(m.i.isText(i))return null!==(o=null===(t=i.nodeValue)||void 0===t?void 0:t.substr(0,r))&&void 0!==o?o:"";const l=i.childNodes[r];if(!l)return"";if(m.i.isText(l))return null!==(n=l.nodeValue)&&void 0!==n?n:"";const u=m.i.findNotEmptyNeighbor(l,!0,i);return m.i.isText(u)&&null!==(s=l.nodeValue)&&void 0!==s?s:""})(s).split(" ").pop();if(i&&(0,l.trim)(i).length){const e=await this.onAutoComplete(i);if(e.length)return this.openPopup(e)}this.popup.isOpened&&this.popup.close()}onKeyControlDown(e){if(this.popup.isOpened&&f.isControlKey(e.key)){switch(e.key){case h.KEY_DOWN:this.list.selectNext();break;case h.KEY_UP:this.list.selectPrevious();break;case h.KEY_TAB:this.list.select()}return this.j.e.stopPropagation(e.type),!1}}onEnter(){if(this.popup.isOpened)return this.list.select(),!1}async onAutoComplete(e){const t=[];return await Promise.all(this.sources.concat(this.j.o.autocomplete.sources).map((async o=>{t.push(...await this.resolveFeed(e,o))}))),t}async resolveFeed(e,t,o){let n;if((0,l.isPromise)(t)&&(t=await t),(0,l.isFunction)(t))n=await t(e);else if((0,l.isArray)(t)){const o=t,{isMatchedQuery:s}=this.j.o.autocomplete;n=o.filter((t=>(0,l.isString)(t)?s(e,t):s(e,t.value))).map((e=>(0,l.isString)(e)?{title:e,value:e}:e))}else n=await this.resolveFeed(e,t.feed,t);if(n&&(0,l.isArray)(n)){const{itemRenderer:e,insertValueRenderer:t,maxItems:s}=this.j.o.autocomplete;return n=n.map((n=>{var s,i;return{itemRenderer:null!==(s=null==o?void 0:o.itemRenderer)&&void 0!==s?s:e,insertValueRenderer:null!==(i=null==o?void 0:o.insertValueRenderer)&&void 0!==i?i:t,...n}})),n.slice(0,s)}return[]}openPopup(e){this.list.build(e),this.popup.open((()=>this.j.s.range.getBoundingClientRect()))}beforeDestruct(e){e.e.off(this.list).off("keydown.autocomplete",this.onKeyDown).off("autocomplete.autocomplete",this.onAutoComplete).off(".autocomplete"),this.list.destruct(),this.popup.destruct()}}(0,n.gn)([r.autobind],f.prototype,"registerAutocompleteSource",null),(0,n.gn)([(0,r.debounce)()],f.prototype,"onKeyDown",null),(0,n.gn)([r.autobind],f.prototype,"onKeyControlDown",null),(0,n.gn)([r.autobind],f.prototype,"onEnter",null),(0,n.gn)([r.autobind],f.prototype,"onAutoComplete",null),(0,n.gn)([r.autobind],f.prototype,"resolveFeed",null),d.Jodit.plugins.add("autocomplete",f)}},e=>e(e.s=40535)])}));