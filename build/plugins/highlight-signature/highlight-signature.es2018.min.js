"use strict";((e,t)=>{if("object"==typeof exports&&"object"==typeof module)module.exports=t();else if("function"==typeof define&&define.amd)define([],t);else{var i=t();for(var r in i)("object"==typeof exports?exports:e)[r]=i[r]}})(self,(function(){return(self.webpackChunkjodit=self.webpackChunkjodit||[]).push([[10],{56953(e,t,i){i.r(t),i.d(t,{highlightSignature:()=>h});var r=i(20255),o=i(35570),s=i(11169),n=i(94522),a=i(11358),l=i(16136);i(27537).D.prototype.highlightSignature={schema:{},excludeTags:["pre"]};class h extends o.S{constructor(){super(...arguments),this.requires=["license"],this.idleId=0}afterInit(e){Object.keys(e.o.highlightSignature.schema).length&&e.e.on("change afterSetMode",this.walkNodes).on("afterGetValueFromEditor",h.removeUtilWrappers)}beforeDestruct(e){e.e.off("change afterSetMode",this.walkNodes).off("afterGetValueFromEditor",h.removeUtilWrappers)}walkNodes(){if(!this.j.isEditorMode())return;this.checkUtilsBoxToSchema();const{j:e}=this,t=e.ed.createNodeIterator(e.editor,NodeFilter.SHOW_TEXT);this.j.async.cancelIdleCallback(this.idleId),this.workLoop(t)}runWorker(e,t){let i;this.j.e.mute();try{do{if(i=t.nextNode(),!i)return;if(this.checkNormalizing(i))return;this.checkReplaceSchemas(i)}while(i&&e.timeRemaining()>0)}finally{this.j.e.unmute()}this.workLoop(t)}workLoop(e){this.idleId=this.j.async.requestIdleCallback((t=>{this.runWorker(t,e)}),{timeout:this.j.defaultTimeout})}checkNormalizing(e){return!!n.i.isText(e.nextSibling)&&(this.j.editor.normalize(),this.walkNodes(),!0)}checkReplaceSchemas(e){if(h.hasUtilWrapper(e))return;const t=e.nodeValue;if(null==t)return;const{j:i}=this,r=i.o.highlightSignature;for(const i in r.schema){const o=RegExp(i);if(o.test(t)){const s=t.match(o);if(!s||void 0===s.index)continue;const a=r.schema[i](this.j,s);if(a)return n.i.markTemporary(a,{dataHighlightSchema:i}),void this.replaceMatchedTextToElm(e,t,s,a)}}}replaceMatchedTextToElm(e,t,i,r){var o;const{j:s}=this,{range:a}=s.s,l=a.startContainer===e,h=a.startOffset,c=null!==(o=i.index)&&void 0!==o?o:0;e.nodeValue=t.substr(0,c);const d=t.substr(c+i[0].length);if(d.length){const t=s.createInside.text(d);n.i.after(e,t)}r.innerText=i[0],n.i.after(e,r),l&&this.restoreCursorPosition(h,e,r.firstChild,r.nextSibling)}static hasUtilWrapper(e){return n.i.isTemporary(e.parentElement)}static removeUtilWrappers(e){e.value=n.i.replaceTemporaryFromString(e.value)}restoreCursorPosition(e,...t){for(const i of t)if(i&&i.nodeValue){const t=i.nodeValue;if(t.length>=e){const t=this.j.s.createRange();t.setStart(i,e),this.j.s.selectRange(t,!1);break}e-=t.length}}checkUtilsBoxToSchema(){n.i.temporaryList(this.j.editor).forEach((e=>{var t;const i=(0,a.Lj)(e,"dataHighlightSchema");if(!i)return;const r=RegExp(i),o=null!==(t=e.innerText)&&void 0!==t?t:"";r.test(o)&&!o.replace(r,"").length||(this.j.s.save(),n.i.unwrap(e),this.j.s.restore())}))}}(0,r.gn)([(0,s.debounce)()],h.prototype,"walkNodes",null),(0,r.gn)([s.autobind],h.prototype,"runWorker",null),l.Jodit.plugins.add("highlight-signature",h)}},e=>e(e.s=56953)])}));